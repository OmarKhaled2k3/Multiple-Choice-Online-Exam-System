{% extends 'quiz/base.html' %}
{% block title %}Take Quiz{% endblock %}
{% block content %}

<div class="bg-primary text-white py-2" style="width: 100%; position: fixed; top: 0; z-index: 1000;">
    <div class="container d-flex justify-content-between align-items-center">
        <!-- Navigation Links -->
        <a href="/" class="text-white text-decoration-none fw-bold">Home</a>
        <a href="/logout" class="text-white text-decoration-none fw-bold">Logout</a>
    </div>
</div>

<h1 class="text-center text-primary mb-4" style="font-weight: bold;">Quiz for {{ username }}</h1>
<div align="right" id="displaytimer"><b>Timer: {{ remaining_minutes }}:{{ remaining_seconds|stringformat:"02" }}</b></div>
<div class="container mt-4">
    <form method="post" id="form__submit">
        {% csrf_token %}
        {% for q in questions %}
            <div class="mb-3">
                <p>{{ q.question }}</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ q.question }}" value="{{ q.op1 }}" id="option1-{{ q.question }}" required>
                    <label class="form-check-label" for="option1-{{ q.question }}">{{ q.op1 }}</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ q.question }}" value="{{ q.op2 }}" id="option2-{{ q.question }}" required>
                    <label class="form-check-label" for="option2-{{ q.question }}">{{ q.op2 }}</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ q.question }}" value="{{ q.op3 }}" id="option3-{{ q.question }}" required>
                    <label class="form-check-label" for="option3-{{ q.question }}">{{ q.op3 }}</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ q.question }}" value="{{ q.op4 }}" id="option4-{{ q.question }}" required>
                    <label class="form-check-label" for="option4-{{ q.question }}">{{ q.op4 }}</label>
                </div>
            </div>
        {% endfor %}
        <button type="submit" id="submitBtn" class="btn btn-primary">Submit Quiz</button>
    </form>
</div>

{% block script %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const timerElement = document.getElementById('displaytimer');
        let timeLeft = {{ remaining_time }}; // Time in seconds

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function updateTimer() {
            if (timeLeft > 0) {
                timeLeft--;
                timerElement.innerHTML = `<b>Timer: ${formatTime(timeLeft)}</b>`;
            } else {
                timerElement.innerHTML = `<b>Time's up!</b>`;
                document.getElementById("form__submit").submit();
            }
        }

        // Update the timer every second
        setInterval(updateTimer, 1000);
    });
</script>
{% endblock %}
{% endblock %}
