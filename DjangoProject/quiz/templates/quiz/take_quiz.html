{% extends 'quiz/base.html' %}
{% block title %}Take Quiz{% endblock %}
{% block content %}
<div class="quiz-container">
    <h1>Quiz for {{ username }}</h1>
    <div align="right" id="displaytimer"><b>Timer: 20 seconds</b></div>

    <form method="post" id="form__submit">
        {% csrf_token %}
        {% for q in questions %}
            <div class="mb-3">
                <p>{{ q.question }}</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ q.question }}" value="option1" id="option1-{{ q.question }}" required>
                    <label class="form-check-label" for="option1-{{ q.question }}">
                        {{ q.op1 }}
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ q.question }}" value="option2" id="option2-{{ q.question }}" required>
                    <label class="form-check-label" for="option2-{{ q.question }}">
                        {{ q.op2 }}
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ q.question }}" value="option3" id="option3-{{ q.question }}" required>
                    <label class="form-check-label" for="option3-{{ q.question }}">
                        {{ q.op3 }}
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="{{ q.question }}" value="option4" id="option4-{{ q.question }}" required>
                    <label class="form-check-label" for="option4-{{ q.question }}">
                        {{ q.op4 }}
                    </label>
                </div>
            </div>
        {% endfor %}
        <button type="submit" id="submitBtn" class="btn btn-primary">Submit Quiz</button>
    </form>

    {% block script %}
    <script>
      // Timer and form logic
      let timer = document.getElementById('displaytimer');
      let submitBtn = document.getElementById('submitBtn');
      let form = document.getElementById("form__submit");
      let t = 120; // Timer duration in seconds

      function submitForm() {
        form.submit(); // Automatically submit the form
      }

      function updateTimer() {
        t--;
        timer.innerHTML = "<b>Timer: " + t + " seconds</b>";
        if (t <= 0) {
          clearInterval(timerInterval); // Stop the timer
          timer.innerHTML = "<b>Time's up!</b>"; // Update timer message
          submitBtn.disabled = true; // Disable the submit button
          submitForm(); // Submit the form automatically
        }
      }

      // Start the timer and update it every second
      const timerInterval = setInterval(updateTimer, 1000);

      // Submit form automatically after the timer ends
      setTimeout(submitForm, t * 1000);
    </script>
    {% endblock %}
</div>
{% endblock %}
